@page "/Account/Manage/PasswordChanged"
@using MOSTComputers.Services.Identity.Models
@using Microsoft.AspNetCore.Identity

@inject UserManager<PasswordsTableOnlyUser> UserManager
@inject SignInManager<PasswordsTableOnlyUser> SignInManager
@inject IdentityUserAccessor UserAccessor
@inject IdentityRedirectManager RedirectManager
@inject ILogger<ChangePassword> Logger

@code {

    [CascadingParameter]
    private HttpContext HttpContext { get; set; } = default!;

    [SupplyParameterFromQuery]
    private string? ReturnUrl { get; set; }

    protected override async Task OnInitializedAsync()
    {
        PasswordsTableOnlyUser user = await UserAccessor.GetRequiredUserAsync(HttpContext);
       
        await SignInManager.RefreshSignInAsync(user);

        Logger.LogInformation("User changed their password successfully.");

        RedirectManager.RedirectToWithStatus(ReturnUrl ?? "", "Your password has been changed", HttpContext);
    }
}