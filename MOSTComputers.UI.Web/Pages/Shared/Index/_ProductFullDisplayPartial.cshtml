@using MOSTComputers.Models.Product.Models
@using MOSTComputers.Models.Product.Models.ProductImages
@using MOSTComputers.UI.Web.Controllers;
@using MOSTComputers.UI.Web.Controllers.Images
@using MOSTComputers.UI.Web.Pages.Shared.ProductEditor.ProductSearchStringData
@using MOSTComputers.UI.Web.Pages.Shared.ProductSearchString

@using static MOSTComputers.Models.Product.MappingUtils.ProductStatusMapping;

@model ProductFullDisplayPartialModel
@{
}

<div class="modal-header full-parent-width red-and-white-theme">

    @if (Model.Product.Manufacturer is not null)
    {
        <h4 class="mb-0">Manufacturer: @Model.Product.Manufacturer.RealCompanyName</h4>
    }

    @if (Model.Product.Category is not null)
    {
        <h4 class="mb-0">Category: @Model.Product.Category?.Description</h4>
    }

    <h4 class="modal-title modal-product-name">ID: @(Model.Product.Id)</h4>
    <h4 class="modal-title modal-product-name">@(Model.Product.Name ?? "-")</h4>
    <h4 class="modal-title modal-product-name">
        @(GetBGStatusStringFromStatusEnum(Model.Product.Status) ?? "-")
    </h4>

    <button type="button" class="btn-close ms-2" data-dismiss="modal" aria-label="Close" onclick="closeModal('@Model.ModalData.ModalId')">
    </button>
</div>

<div id="ProductFullDisplayWithXml_popup" class="modal-body full-parent-width bg-white overflow-y-auto">
    <div class="container-fluid border-2 full-parent-width full-parent-height">
        <div class="full-parent-width">
            <div class="row d-flex mb-5">
                <div class="col-lg-6 align-content-start">
                    <ul class="list-style-none">

                        <li class="product-full-popup-name-and-partnumber-li">
                            <h4>EAN: @Model.Product.PartNumber1</h4>
                            <h4>Part №: @Model.Product.PartNumber2</h4>
                        </li>
                    </ul>
                </div>

                <div class="col-lg-4 align-content-start">
                    <ul class="product-full-popup-xml-and-link-buttons-list">
                        <li>
                            <button class="btn btn-secondary" onclick='openProductXmlDataInNewWindowById(@Model.Product.Id)'>
                                XML
                            </button>

                            <button class="btn btn-secondary">
                                Copy link
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="col-lg-2 align-content-start">
                    <div class="full-parent-width full-parent-height product-full-popup-price-wrapper">
                        <div class="product-full-popup-price red-and-white-theme">
                            <b class="fw-bold">ЦЕНА:</b>
                            <span class="product-full-popup-price-display-span">
                                @Model.Product.Price @Model.Product.Currency с ДДС
                                <br/>
                                <span class="product-full-popup-usd-price-display-span">(@Model.Product.Price USD)</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row d-flex">
                <div class="col-lg-6 product-full-popup-carousel-container">
                    <div id="product_full_popup_carousel" class="carousel slide product-full-popup-carousel" data-bs-ride="carousel" data-bs-interval="2400">

                        <div class="carousel-inner product-full-popup-carousel-inner" role="listbox">

                            @if (Model.ProductImages is not null)
                            {
                                for (int i = 0; i < Model.ProductImages.Count; i++)
                                {
                                    ProductImageData? productImage = Model.ProductImages[i];

                                    string imageSrc = $"/{ProductImageDataController.ControllerRoute}/{productImage.Id}";

                                    string imageActiveString = (i == 0) ? "active" : "";
 
                                    <div class="carousel-item full-parent-height @imageActiveString" id="slide-content-@i">
                                        <div class="full-parent-width full-parent-height d-flex justify-content-center">
                                            <img src="@imageSrc" class="product-full-popup-carousel-item-img" alt="Image @i">
                                        </div>
                                    </div>
                                }
                            }
                        </div>

                        <!-- Left and right controls -->
                        <a class="left carousel-control text-decoration-none" data-bs-target="#product_full_popup_carousel" role="button" data-bs-slide="prev">
                            <span class="fw-bolder product-full-popup-carousel-control-text-span" aria-hidden="true">
                                &lt;
                            </span>
                        </a>
                        <a class="right carousel-control text-decoration-none product-full-popup-right-carousel-control"
                            data-bs-target="#product_full_popup_carousel" role="button" data-bs-slide="next">
                            <span class="fw-bolder product-full-popup-carousel-control-text-span" aria-hidden="true">
                                &gt;
                            </span>
                        </a>

                        <div id="slider-thumbs" class="row hidden-xs product-full-popup-carousel-image-navbar-container">

                            <ul class="product-full-popup-carousel-image-navbar-list">

                                @if (Model.ProductImages is not null)
                                {
                                    for (int i = 0; i < Model.ProductImages.Count; i++)
                                    {
                                        ProductImageData? productImage = Model.ProductImages[i];

                                        string imageSrc = $"/{ProductImageDataController.ControllerRoute}/{productImage.Id}";

                                        <li class="col-sm-2 product-full-popup-carousel-image-navbar-list-item">
                                            <a id="carousel-selector-@i" class="thumbnail" data-bs-target="#product_full_popup_carousel" data-bs-slide-to="@i">
                                                <img src="@imageSrc" class="full-parent-width" alt="Navigate to image @i">
                                            </a>
                                        </li>
                                    }
                                }
                            </ul>
                        </div>
                    </div>

                </div>

                <div class="col-lg-6">
                    <div class="full-parent-width full-parent-height product-full-popup-manufacturer-site-link-display-container">
                        <h3 class="product-full-popup-manufacturer-site-link-top-label">Информация за услугата</h3>
                    </div>
                </div>
            </div>
        </div>

        @if (Model.SearchStringParts is not null
            && Model.SearchStringParts.Count > 0)
        {
            <div class="full-parent-width pt-4 pb-5">

                <div class="full-parent-width mb-2">
                    <h6 class="m-0">
                        Search String:
                    </h6>
                </div>

                <div class="full-parent-width mb-2">
                    <h5 class="m-0">
                        @Model.Product.SearchString
                    </h5>
                </div>

                <partial name="ProductSearchString/_SearchStringPartsTablePartial" model="new SearchStringPartsTablePartialModel()
                {
                    SearchStringParts = Model.SearchStringParts,
                }" />
            </div>
        }

        @{
            List<ProductProperty> productLinks = new();
        }

        <div class="full-parent-width pt-4 pb-5">
            <section class="product-full-popup-props-section">
                @if (Model.ProductProperties is not null)
                {
                    foreach (ProductProperty property in Model.ProductProperties)
                    {
                        ProductCharacteristic? relatedCharacteristic = Model.ProductCharacteristics?
                            .FirstOrDefault(x => x.Id == property.ProductCharacteristicId);

                        if (relatedCharacteristic?.KWPrCh == ProductCharacteristicType.Link)
                        {
                            productLinks.Add(property);

                            continue;
                        }

                        <div class="product-full-popup-props-section-item">
                            <strong>@property.Characteristic:</strong><br/><p class="product-full-popup-props-section-item-value-text">@property.Value</p>
                        </div>
                    }
                }
            </section>
        </div>

        @if (productLinks.Count > 0)
        {
            <div class="full-parent-width pt-4 pb-5">
                <ul class="full-parent-width d-flex flex-column list-unstyled">
                    @foreach (ProductProperty property in productLinks)
                    {
                        <li class="full-parent-width d-flex flex-row flex-nowrap flex-sm-wrap">
                            <p class="mb-0">@property.Characteristic:&nbsp;</p>
                            <a href="@property.Value">@property.Value</a>
                        </li>
                    }
                </ul>
            </div>
        }
    </div>
</div>

<div class="modal-footer full-parent-width">
    
</div>