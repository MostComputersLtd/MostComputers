@using MOSTComputers.Models.Product.Models.Requests.Product;
@using MOSTComputers.UI.Web.Mapping;
@using MOSTComputers.UI.Web.Models;
@using MOSTComputers.Models.Product.MappingUtils;

@model List<XmlProductCreateDisplay>

@for (int i = 0; i < Model.Count; i++)
{
    <h1 class="create-request-name">@Model[i].Name</h1>
    
    <ul class="create-request-image-list">

        @if (Model[i].Images is not null)
        {
            foreach (CurrentProductImageCreateRequest imageCreateRequest in Model[i].Images!)
            {
                if (imageCreateRequest.ImageData is null) continue;

                <li>
                    <img src="data:@imageCreateRequest.ImageContentType;base64,@Convert.ToBase64String(imageCreateRequest.ImageData)"
                        style="width:300px;" />
                </li>
            }
        }
    </ul>

    <h3 class="create-request-origins-text">Origins and identification</h3>

    <div class="element-collection">

        <strong class="create-request-important-characteristic">Category:</strong>

        <label class="element-collection-dataItem">@Model[i].Category?.Description</label>

    </div>

    <div class="element-collection">

        <strong class="create-request-important-characteristic">Manifacturer:</strong>

        <label class="element-collection-dataItem">@Model[i].Manifacturer?.RealCompanyName</label>

    </div>

    <div class="element-collection">

        <strong class="create-request-important-characteristic">Part No. 1:</strong>

        <label class="element-collection-dataItem">@Model[i].PartNumber1</label>

    </div>

    <div class="element-collection">

        <strong class="create-request-important-characteristic">Part No. 2:</strong>

        <label class="element-collection-dataItem">@Model[i].PartNumber2</label>

    </div>

    <div class="element-collection">

        <strong class="create-request-important-characteristic">SearchString:</strong>

        <label class="element-collection-dataItem">@Model[i].SearchString</label>

    </div>

    <div class="element-collection">

        <strong class="create-request-important-characteristic">Status:</strong>

        <label class="element-collection-dataItem">@ProductStatusMapping.GetBGStatusStringFromStatusEnum(Model[i].Status)</label>

    </div>

    var properties = Model[i].Properties;

    @if (properties is not null)
    {
        <h3 class="create-request-characteristics-text">Characteristics</h3>

        <div id="propertiesDataContainer-@i">

            <table class="full-parent-width" style="margin:20px 25px">
                <tbody>
                    @for (int j = 0; j < properties.Count; j++)
                    {
                        DisplayPropertyCreateRequest propertyCreateRequest = properties[j];
                        <tr>
                            <td style="width:20%;">
                                @if (propertyCreateRequest.ProductCharacteristicId == null)
                                {
                                     // <select asp-items="@Model[i].Characteristics" onselect="Failed_Characteristic_Name_Select_onSelect(@i,@propertyCreateRequest.Name,this.value)"></select>
                                    <select name="InvalidPropertySelect-@i.ToString()-@j.ToString()" asp-items="@Model[i].Characteristics"
                                        onchange="Failed_Characteristic_Name_Select_onSelect(@i,'@propertyCreateRequest.Name',this.value)"></select>
                                }
                                else
                                {  
                                    <label>@propertyCreateRequest.Name</label>
                                }

                            </td>

                            <td style="width:60%;">
                                <label class="element-collection-dataItem">@propertyCreateRequest.Value</label>
                            </td>

                            <td style="width:10%;">
                                <label name="PropertyIdText-@i.ToString()-@j.ToString()">ID: @propertyCreateRequest.ProductCharacteristicId</label>
                            </td>
                        </tr>

                        if (propertyCreateRequest.ProductCharacteristicId == null)
                        {
                            <tr>
                                <td colspan="3">
                                    <p class="invalid-characteristic-name-text">
                                        The product characteristic "@propertyCreateRequest.Name" does not exist, please select a characteristic from the ones above
                                    </p>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>

        </div>
    }
}
